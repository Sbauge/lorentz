<!DOCTYPE html>
<html>
<head>
    <title>Vessel Positions Map</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBdx6pGc107_izBWxnNBhdJ28Fh16e0Aoo"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
        var map;
        var markers = []; // Array to hold the markers

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: {lat: 59.397, lng: 5.644},
                zoom: 8,
                styles: [{ /* Add your dark blue minimalistic style here */ }]
            });

            loadData(); // Load data initially
            setInterval(loadData, 300000); // Refresh data every 5 minutes
        }

        function loadData() {
            // Clear existing markers from the map
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(null);
            }
            markers = []; // Reset the markers array

            var spreadsheetId = '1x7nEzYLUm3fpocDHsMGfmxo0L3chH9hRsq-4xwF_DFc'; // Replace with your Google Sheet ID
            var range = 'Sheet1!A:C'; // Adjust the range accordingly
            var apiKey = 'AIzaSyBdx6pGc107_izBWxnNBhdJ28Fh16e0Aoo'; // Replace with your Google Sheets API key

            var url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${range}?key=${apiKey}`;

            $.getJSON(url, function(data) {
                var rows = data.values;
                if (rows.length > 0) {
                    for (var i = 0; i < rows.length; i++) {
                        var vesselName = rows[i][0];
                        var longitude = parseFloat(rows[i][1]);
                        var latitude = parseFloat(rows[i][2]);

                        // Create a marker and set its position
                        var marker = new google.maps.Marker({
                            map: map,
                            position: {lat: latitude, lng: longitude},
                            title: vesselName
                        });

                        // Add the marker to our array of markers
                        markers.push(marker);
                    }
                }
            });
        }
    </script>
</head>
<body onload="initMap()">
    <div id="map" style="width:100%;height:500px;"></div>
</body>
</html>
